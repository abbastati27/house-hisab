(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{3379:function(t,e,s){Promise.resolve().then(s.bind(s,5368))},5368:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return m}});var n=s(7437),i=s(3191),r=s(932),a=s(5524),o=s(2265),c=s(3318),l=s(231),u=s.n(l);function d(t){let{children:e,rightActions:s,className:i=""}=t,r=(0,o.useRef)(null),a=(0,o.useRef)(0),[c,l]=(0,o.useState)(0),[u,d]=(0,o.useState)(!1);function h(){let t=c<-72;d(t),l(t?-128:0),r.current=null}return(0,n.jsxs)("div",{className:"relative overflow-hidden select-none ".concat(i),children:[(0,n.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-stretch gap-1 pr-2 pl-4","aria-hidden":!0,children:s}),(0,n.jsx)("div",{className:"bg-white",style:{transform:"translateX(".concat(c,"px)"),transition:null==r.current?"transform 160ms ease":"none"},onTouchStart:function(t){r.current=t.touches[0].clientX,a.current=c},onTouchMove:function(t){if(null==r.current)return;let e=t.touches[0].clientX-r.current,s=a.current+e;l(s=Math.min(0,Math.max(-160,s)))},onTouchEnd:h,onTouchCancel:h,onClick:function(){d(!1),l(0)},children:e})]})}async function h(t){let e=await fetch("http://localhost:8000"+t,{cache:"no-store"});if(!e.ok)throw Error("Failed");return e.json()}function m(){let t=(0,i.NL)(),[e,s]=(0,o.useState)(""),[l,m]=(0,o.useState)(""),[v,j]=(0,o.useState)(""),[N,b]=(0,o.useState)(""),[y,g]=(0,o.useState)("category_id"),[C,_]=(0,o.useState)("asc"),S=new URLSearchParams;e&&S.set("type",e),l&&S.set("fund",l),v&&S.set("q",v),""!==N&&S.set("posting",String(N));let{data:k}=(0,r.a)({queryKey:["txns",S.toString()],queryFn:()=>h("/api/v1/transactions?".concat(S.toString()))}),E=(0,a.D)({mutationFn:async t=>{let e=await fetch("http://localhost:8000"+"/api/v1/transactions/".concat(t),{method:"DELETE"});if(!e.ok)throw Error("Delete failed");return e.json()},onSuccess:()=>t.invalidateQueries({queryKey:["txns"]})}),O=(0,o.useMemo)(()=>{let t=(k||[]).slice(),e="asc"===C?1:-1;return t.sort((t,s)=>{let n=p(t,y),i=p(s,y);if("number"==typeof n&&"number"==typeof i)return(n-i)*e;let r=String(null!=n?n:""),a=String(null!=i?i:"");return r.localeCompare(a)*e}),t},[k,y,C]);function M(t){t===y?_("asc"===C?"desc":"asc"):(g(t),_("asc"))}return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Transactions"}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 items-end",children:[(0,n.jsx)(f,{label:"Type",value:e,onChange:s,options:["","CONTRIBUTION","INCOME","EXPENSE","TRANSFER"]}),(0,n.jsx)(f,{label:"Fund",value:l,onChange:m,options:["","CASH","ONLINE_A","ONLINE_Y"]}),(0,n.jsx)(f,{label:"Posting",value:""===N?"":String(N),onChange:t=>b(""===t?"":"true"===t),options:["","true","false"]}),(0,n.jsxs)("div",{className:"flex-1 min-w-[160px]",children:[(0,n.jsx)("label",{className:"block text-xs text-slate-600",children:"Search"}),(0,n.jsx)("input",{value:v,onChange:t=>j(t.target.value),className:"w-full border rounded px-3 py-2",placeholder:"notes/party"})]})]}),(0,n.jsx)("div",{className:"md:hidden divide-y rounded border bg-white",children:O.map(t=>(0,n.jsx)(d,{rightActions:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(u(),{href:"/transactions/edit?id=".concat(encodeURIComponent(t.id)),className:"bg-blue-600 text-white px-3 py-2 rounded self-center",children:"Edit"}),(0,n.jsx)("button",{onClick:()=>E.mutate(t.id),className:"bg-red-600 text-white px-3 py-2 rounded self-center",children:"Delete"})]}),children:(0,n.jsxs)(u(),{href:"/transactions/edit?id=".concat(encodeURIComponent(t.id)),className:"block p-3",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,n.jsxs)("div",{className:"font-medium",children:[t.txn_type," • ",t.category_id||t.person_id||t.party||"—"]}),(0,n.jsx)("div",{children:(0,c.Z)(t.amount_paise)})]}),(0,n.jsxs)("div",{className:"text-xs text-slate-600",children:[t.date," • ",t.fund_from||"",t.fund_from&&t.fund_to?" → ":"",t.fund_to||""]}),t.notes&&(0,n.jsx)("div",{className:"text-xs mt-1",children:t.notes})]})},t.id))}),(0,n.jsx)("div",{className:"hidden md:block rounded border bg-white",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{className:"bg-slate-50 text-left",children:[(0,n.jsx)(x,{active:"date"===y,dir:C,onClick:()=>M("date"),children:"Date"}),(0,n.jsx)(x,{active:"txn_type"===y,dir:C,onClick:()=>M("txn_type"),children:"Type"}),(0,n.jsx)(x,{active:"amount_paise"===y,dir:C,onClick:()=>M("amount_paise"),children:"Amount"}),(0,n.jsx)(x,{active:"fund_from"===y,dir:C,onClick:()=>M("fund_from"),children:"From"}),(0,n.jsx)(x,{active:"fund_to"===y,dir:C,onClick:()=>M("fund_to"),children:"To"}),(0,n.jsx)(x,{active:"person_id"===y,dir:C,onClick:()=>M("person_id"),children:"Person"}),(0,n.jsx)(x,{active:"category_id"===y,dir:C,onClick:()=>M("category_id"),children:"Category"}),(0,n.jsx)(x,{active:"party"===y,dir:C,onClick:()=>M("party"),children:"Party"}),(0,n.jsx)(x,{active:"notes"===y,dir:C,onClick:()=>M("notes"),children:"Notes"}),(0,n.jsx)(x,{active:"posting"===y,dir:C,onClick:()=>M("posting"),children:"Posting"}),(0,n.jsx)("th",{className:"p-2"})]})}),(0,n.jsx)("tbody",{children:O.map(t=>{var e,s,i,r,a,o;return(0,n.jsxs)("tr",{className:"border-t",children:[(0,n.jsx)("td",{className:"p-2",children:t.date}),(0,n.jsx)("td",{className:"p-2",children:t.txn_type}),(0,n.jsx)("td",{className:"p-2",children:(0,c.Z)(t.amount_paise)}),(0,n.jsx)("td",{className:"p-2",children:null!==(e=t.fund_from)&&void 0!==e?e:""}),(0,n.jsx)("td",{className:"p-2",children:null!==(s=t.fund_to)&&void 0!==s?s:""}),(0,n.jsx)("td",{className:"p-2",children:null!==(i=t.person_id)&&void 0!==i?i:""}),(0,n.jsx)("td",{className:"p-2",children:null!==(r=t.category_id)&&void 0!==r?r:""}),(0,n.jsx)("td",{className:"p-2",children:null!==(a=t.party)&&void 0!==a?a:""}),(0,n.jsx)("td",{className:"p-2",children:null!==(o=t.notes)&&void 0!==o?o:""}),(0,n.jsx)("td",{className:"p-2",children:String(t.posting)}),(0,n.jsx)("td",{className:"p-2 text-right",children:(0,n.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,n.jsx)(u(),{href:"/transactions/edit?id=".concat(encodeURIComponent(t.id)),className:"text-blue-600 hover:underline",children:"Edit"}),(0,n.jsx)("button",{onClick:()=>E.mutate(t.id),className:"text-red-600 hover:underline",children:"Delete"})]})})]},t.id)})})]})})]})}function p(t,e){return"amount_paise"===e?t.amount_paise:"posting"===e?t.posting?1:0:t[e]}function x(t){let{children:e,onClick:s,active:i,dir:r}=t;return(0,n.jsx)("th",{className:"p-2 select-none",children:(0,n.jsxs)("button",{onClick:s,className:"inline-flex items-center gap-1 ".concat(i?"underline":""),children:[e,i&&("asc"===r?"▲":"▼")]})})}function f(t){let{label:e,value:s,onChange:i,options:r}=t;return(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs text-slate-600",children:e}),(0,n.jsx)("select",{value:s,onChange:t=>i(t.target.value),className:"border rounded px-2 py-1",children:r.map(t=>(0,n.jsx)("option",{value:t,children:""===t?"Any":t},t))})]})}},3318:function(t,e,s){"use strict";function n(t){let e=t.replace(/[,\s₹]/g,"");if(!e)return 0;let s=Number(e);return Number.isNaN(s)?0:Math.round(100*s)}function i(t){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format((t||0)/100)}s.d(e,{Z:function(){return i},f:function(){return n}})},5524:function(t,e,s){"use strict";s.d(e,{D:function(){return d}});var n=s(2265),i=s(2812),r=s(9948),a=s(9010),o=s(6298),c=class extends a.l{#t;#e=void 0;#s;#n;constructor(t,e){super(),this.#t=t,this.setOptions(e),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#t.defaultMutationOptions(t),(0,o.VS)(this.options,e)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,o.Ym)(e.mutationKey)!==(0,o.Ym)(this.options.mutationKey)?this.reset():this.#s?.state.status==="pending"&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#r(t)}getCurrentResult(){return this.#e}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#i(),this.#r()}mutate(t,e){return this.#n=e,this.#s?.removeObserver(this),this.#s=this.#t.getMutationCache().build(this.#t,this.options),this.#s.addObserver(this),this.#s.execute(t)}#i(){let t=this.#s?.state??(0,i.R)();this.#e={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#r(t){r.V.batch(()=>{if(this.#n&&this.hasListeners()){let e=this.#e.variables,s=this.#e.context;t?.type==="success"?(this.#n.onSuccess?.(t.data,e,s),this.#n.onSettled?.(t.data,null,e,s)):t?.type==="error"&&(this.#n.onError?.(t.error,e,s),this.#n.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach(t=>{t(this.#e)})})}},l=s(3191),u=s(7832);function d(t,e){let s=(0,l.NL)(e),[i]=n.useState(()=>new c(s,t));n.useEffect(()=>{i.setOptions(t)},[i,t]);let a=n.useSyncExternalStore(n.useCallback(t=>i.subscribe(r.V.batchCalls(t)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),o=n.useCallback((t,e)=>{i.mutate(t,e).catch(u.Z)},[i]);if(a.error&&(0,u.L)(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:o,mutateAsync:a.mutate}}}},function(t){t.O(0,[336,932,403,971,23,744],function(){return t(t.s=3379)}),_N_E=t.O()}]);